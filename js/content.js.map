{"version":3,"sources":["content.js"],"names":["currentData","shopId","itemId","addIframe","async","urlHistory","utils","getHistoryUrl","autoShow","storage","get","undefined","productBriefing","document","querySelector","chartWrapper","createElement","id","className","innerHTML","parentNode","insertBefore","nextSibling","addButton","itemsCenter","querySelectorAll","btnWrapper","filter","e","textContent","indexOf","classList","add","urlIcon","chrome","runtime","getURL","btn","onclick","preventDefault","remove","window","scrollTo","offsetTop","appendChild","initContent","onShopeeDomReady","getUrlInfo","forEach","onUrlChange","callback","body","isOtherLink","target","closest","otherLink","href","newShopId","newItemId","setTimeout"],"mappings":"AAAA,IAAIA,YAAc,CACdC,OAAQ,KACRC,OAAQ,MAGZ,MAAMC,UAAYC,UACd,MAAMC,EAAaC,MAAMC,gBAEzB,GAAIF,EAAY,CACZ,IAAIG,QAAiBC,QAAQC,IAAI,YACjCF,OAAwBG,IAAbH,GAAgCA,EAC3C,IAAII,EAAkBC,SAASC,cAAc,qBACzCC,EAAeF,SAASG,cAAc,OAC1CD,EAAaE,GAAK,wBAClBF,EAAaG,mCAAqCV,EAAW,GAAK,mBAClEO,EAAaI,yFAA2Fd,cAExGO,EAAgBQ,WAAWC,aAAaN,EAAcH,EAAgBU,eAIxEC,UAAY,KACd,IAAIC,EAAcX,SAASY,iBAAiB,8CAExCC,GADJF,EAAc,IAAIA,GAAaG,OAAOC,IAAqC,IAAhCA,EAAEC,YAAYC,QAAQ,OACpC,GAAGV,WAChCM,EAAWK,UAAUC,IAAI,uBAEzB,IAAIC,EAAUC,OAAOC,QAAQC,OAAO,sBAChCC,EAAMxB,SAASG,cAAc,KACjCqB,EAAIpB,GAAK,cACToB,EAAInB,UAAY,uDAEhBmB,EAAIlB,uBAAyBc,4CAE7BI,EAAIC,QAAU,CAACV,IACXA,EAAEW,iBAEF,IAAIxB,EAAeF,SAASC,cAAc,0BAC1CC,EAAagB,UAAUS,OAAO,kBAC9BC,OAAOC,SAAS,EAAG3B,EAAa4B,aAGpCjB,EAAWkB,YAAYP,IAGrBQ,YAAc,KAChBvC,MAAMwC,iBAAiB,KACnB,IAAI7C,OAACA,EAAMC,OAAEA,GAAUI,MAAMyC,aAE7B,GAAI9C,GAAUC,EAAQ,CAClBF,YAAYC,OAASA,EACrBD,YAAYE,OAASD,EAErB,IACIY,SAASY,iBAAiB,0BAA0BuB,QAAQpB,GAAKA,EAAEY,UACnE3B,SAASC,cAAc,gBAAgBkC,QAAQpB,GAAKA,EAAEY,UACxD,MAAOZ,IAGTL,YACApB,gBAKN8C,YAAeC,IACjBrC,SAASsC,KAAKb,QAAU,SAAUV,GAC9B,IAAIwB,EAAcxB,EAAEyB,OAAOC,QAAQ,WAEnC,GAAIF,EAAa,CACb,IAAIG,EAAYH,EAAYI,MACvBvD,OAAQwD,EAAWvD,OAAQwD,GAAapD,MAAMyC,WAAWQ,GAE1DE,IAAczD,YAAYC,QAAUyD,IAAc1D,YAAYE,QAC9DyD,WAAWT,EAAU,QAMrCL,cAEAI,YAAY,KACRJ","file":"content.js","sourcesContent":["let currentData = {\r\n    shopId: null,\r\n    itemId: null\r\n};\r\n\r\nconst addIframe = async () => {\r\n    const urlHistory = utils.getHistoryUrl();\r\n    \r\n    if (urlHistory) {\r\n        let autoShow = await storage.get('autoShow');\r\n        autoShow = autoShow === undefined ? true : autoShow;\r\n        let productBriefing = document.querySelector('.product-briefing');\r\n        let chartWrapper = document.createElement('div');\r\n        chartWrapper.id = 'beecost-chart-wrapper';\r\n        chartWrapper.className = `beecost-chart-wrapper ${autoShow ? '' : 'beecost-hidden'}`;\r\n        chartWrapper.innerHTML = `<iframe class=\"beecost-chart\" width=\"100%\" height=\"500\" frameBorder=\"0\" src=${urlHistory}></iframe>`;\r\n        \r\n        productBriefing.parentNode.insertBefore(chartWrapper, productBriefing.nextSibling);\r\n    }\r\n};\r\n\r\nconst addButton = () => {\r\n    let itemsCenter = document.querySelectorAll('.product-briefing > div.flex .items-center');\r\n    itemsCenter = [...itemsCenter].filter(e => e.textContent.indexOf('₫') !== -1);\r\n    let btnWrapper = itemsCenter[0].parentNode;\r\n    btnWrapper.classList.add('beecost-btn-wrapper');\r\n    \r\n    let urlIcon = chrome.runtime.getURL('icons/16_white.png');\r\n    let btn = document.createElement('a');\r\n    btn.id = 'beecost-btn';\r\n    btn.className = 'beecost-btn btn btn-solid-primary btn--s btn--inline';\r\n    \r\n    btn.innerHTML = `<img src=\"${urlIcon}\" /> <span>Xem giá theo thời gian</span>`;\r\n    \r\n    btn.onclick = (e) => {\r\n        e.preventDefault();\r\n        \r\n        let chartWrapper = document.querySelector('#beecost-chart-wrapper');\r\n        chartWrapper.classList.remove('beecost-hidden');\r\n        window.scrollTo(0, chartWrapper.offsetTop);\r\n    };\r\n    \r\n    btnWrapper.appendChild(btn);\r\n};\r\n\r\nconst initContent = () => {\r\n    utils.onShopeeDomReady(() => {\r\n        let {shopId, itemId} = utils.getUrlInfo();\r\n        \r\n        if (shopId && itemId) {\r\n            currentData.shopId = shopId;\r\n            currentData.itemId = shopId;\r\n            \r\n            try {\r\n                document.querySelectorAll('#beecost-chart-wrapper').forEach(e => e.remove());\r\n                document.querySelector('#beecost-btn').forEach(e => e.remove());\r\n            } catch (e) {\r\n            }\r\n            \r\n            addButton();\r\n            addIframe();\r\n        }\r\n    });\r\n};\r\n\r\nconst onUrlChange = (callback) => {\r\n    document.body.onclick = function (e) {\r\n        let isOtherLink = e.target.closest('a[href]');\r\n        \r\n        if (isOtherLink) {\r\n            let otherLink = isOtherLink.href;\r\n            let {shopId: newShopId, itemId: newItemId} = utils.getUrlInfo(otherLink);\r\n            \r\n            if (newShopId !== currentData.shopId || newItemId !== currentData.itemId) {\r\n                setTimeout(callback, 2000);\r\n            }\r\n        }\r\n    };\r\n};\r\n\r\ninitContent();\r\n\r\nonUrlChange(() => {\r\n    initContent();\r\n});\r\n"]}